<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>2026 Beast Dashboard</title>

<style>
:root{
  --bg:#0b0c14; --text:#e8eaf3; --muted:rgba(232,234,243,.72);
  --line:rgba(255,255,255,.10); --purple:#7b6cff; --accent:#f6c56b;
  --green:#4ade80; --red:#fb7185; --blue:#60a5fa; --amber:#fbbf24;
}
*{box-sizing:border-box}
body{
  margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:radial-gradient(1200px 600px at 20% 0%, rgba(123,108,255,.22), transparent 55%),
             radial-gradient(900px 500px at 80% 0%, rgba(246,197,107,.16), transparent 60%),
             var(--bg);
  color:var(--text);
}
header{
  position:sticky;top:0;z-index:10;
  padding:14px 16px;border-bottom:1px solid var(--line);
  background:linear-gradient(135deg, rgba(30,27,75,.85), rgba(17,24,39,.55));
}
h1{margin:0;font-size:16px}
.wrap{max-width:1280px;margin:0 auto;padding:16px}
.card{
  background:linear-gradient(180deg, rgba(20,22,42,.95), rgba(12,14,28,.95));
  border:1px solid var(--line);border-radius:14px;padding:14px;margin-bottom:12px;
  box-shadow:0 10px 30px rgba(0,0,0,.35);
}
.small{font-size:12px;color:var(--muted);line-height:1.35}
.kpis{display:grid;grid-template-columns:repeat(auto-fit,minmax(170px,1fr));gap:10px}
.kpi{background:rgba(255,255,255,.03);border:1px solid var(--line);border-radius:12px;padding:10px;text-align:center}
.kpi b{font-size:18px}
.pill{
  display:inline-flex;align-items:center;gap:8px;
  padding:6px 10px;border-radius:999px;border:1px solid var(--line);
  background:rgba(255,255,255,.03);font-size:12px;color:var(--muted);
  margin:4px 6px 0 0;
}
.pill strong{color:var(--text)}
.badge{
  display:inline-flex;align-items:center;gap:6px;
  padding:4px 8px;border-radius:999px;border:1px solid var(--line);
  background:rgba(255,255,255,.03);font-size:12px;color:var(--muted)
}
.tabs{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
.tab{
  padding:8px 10px;border-radius:10px;border:1px solid var(--line);
  background:rgba(255,255,255,.04);cursor:pointer;user-select:none;font-size:13px;
}
.tab.active{background:rgba(123,108,255,.18);border-color:rgba(123,108,255,.35)}
.tabcontent{display:none}
.tabcontent.active{display:block}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(270px,1fr));gap:12px}
.titleRow{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:8px}
.h2{font-size:13px;margin:0;color:rgba(232,234,243,.95);letter-spacing:.2px}
.xpbar{height:10px;border-radius:999px;overflow:hidden;background:rgba(255,255,255,.08);border:1px solid var(--line);margin-top:8px}
.xpfill{height:100%;width:0%;background:linear-gradient(90deg,var(--purple),var(--accent));transition:width .25s ease}
.row{display:flex;justify-content:space-between;gap:10px;margin-top:8px}
.btnRow{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
button{
  border:none;border-radius:10px;padding:8px 10px;cursor:pointer;font-weight:800;
  background:var(--accent);color:#101012;
}
button.secondary{background:rgba(255,255,255,.08);color:var(--text);border:1px solid var(--line)}
button.danger{background:rgba(251,113,133,.95);color:#0b0c14}
button:disabled{opacity:.55;cursor:not-allowed}
hr{border:none;border-top:1px solid var(--line);margin:12px 0}
.warn{color:rgba(251,113,133,.95);font-weight:900}
.ok{color:rgba(74,222,128,.95);font-weight:900}
.twoCol{display:grid;grid-template-columns:repeat(auto-fit,minmax(290px,1fr));gap:12px}
input,select,textarea{
  width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);
  background:rgba(255,255,255,.03);color:var(--text);font-size:13px;
}
table{
  width:100%;border-collapse:separate;border-spacing:0;
  overflow:hidden;border:1px solid var(--line);border-radius:12px;background:rgba(255,255,255,.02);
}
th,td{padding:10px;border-bottom:1px solid var(--line);font-size:13px;text-align:left;white-space:nowrap}
th{background:rgba(255,255,255,.03);color:rgba(232,234,243,.9)}
tr:last-child td{border-bottom:none}
canvas{width:100%;height:260px;border:1px solid var(--line);border-radius:12px;background:rgba(255,255,255,.02)}
.banner{border:1px solid rgba(251,113,133,.35);background:rgba(251,113,133,.08);padding:10px;border-radius:12px;margin-top:10px}
.bannerOk{border:1px solid rgba(74,222,128,.35);background:rgba(74,222,128,.08);padding:10px;border-radius:12px;margin-top:10px}
.progress{height:12px;border-radius:999px;overflow:hidden;background:rgba(255,255,255,.08);border:1px solid var(--line)}
.progress > div{height:100%;width:0%;background:linear-gradient(90deg,var(--purple),var(--accent));transition:width .25s ease}
.calWrap{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;margin-top:10px}
.calDay{border:1px solid var(--line);border-radius:10px;padding:8px;background:rgba(255,255,255,.02);min-height:58px;cursor:pointer}
.calDay .d{font-size:12px;color:rgba(232,234,243,.75)}
.calDay .v{font-size:12px;margin-top:6px;font-weight:900}
.calHead{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;margin-top:8px}
.calHead div{font-size:11px;color:rgba(232,234,243,.6);text-align:center}
.calLegend{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
.swatch{display:inline-flex;align-items:center;gap:6px;font-size:12px;color:var(--muted)}
.box{width:12px;height:12px;border-radius:3px;border:1px solid var(--line);background:rgba(255,255,255,.02)}
.timer{font-size:26px;font-weight:1000;letter-spacing:.5px}
.streakGrid{display:grid;grid-template-columns:repeat(auto-fit,minmax(190px,1fr));gap:10px}
.streakCard{background:rgba(255,255,255,.03);border:1px solid var(--line);border-radius:12px;padding:10px}
.streakCard b{font-size:20px}
</style>
</head>

<body>
<header><h1>2026 Beast Dashboard ‚Äî 4 Pillars + Rank Gate + Weekly Boss Fight + Streaks + Size Gate + Tilt + Apex + Quota + WoW</h1></header>

<div class="wrap">
  <div class="card">
    <div class="kpis">
      <div class="kpi">Overall Rank<br><b id="overallRank">1</b><div class="small" id="rankGateText"></div></div>
      <div class="kpi">Trader Level<br><b id="lvlTrader">1</b><div class="small" id="xpTraderText"></div></div>
      <div class="kpi">Body Level<br><b id="lvlBody">1</b><div class="small" id="xpBodyText"></div></div>
      <div class="kpi">Closer Level<br><b id="lvlCloser">1</b><div class="small" id="xpCloserText"></div></div>
      <div class="kpi">Family Level<br><b id="lvlFamily">1</b><div class="small" id="xpFamilyText"></div></div>
    </div>

    <div style="margin-top:10px">
      <span class="pill" id="pillTradeToday"><strong>Trading Today:</strong> ...</span>
      <span class="pill" id="pillTradeNext"><strong>Trading Next Day:</strong> ...</span>
      <span class="pill" id="pillPenalty"><strong>Penalty:</strong> ...</span>
      <span class="pill" id="pillTilt"><strong>Tilt:</strong> ...</span>
      <span class="pill" id="pillSize"><strong>Size Up:</strong> ...</span>
      <span class="pill" id="pillWow"><strong>WoW (30m):</strong> ...</span>
    </div>

    <div class="tabs">
      <div class="tab active" data-tab="pillars">Pillars</div>
      <div class="tab" data-tab="trading">Trading</div>
      <div class="tab" data-tab="sales">Sales</div>
      <div class="tab" data-tab="apex">Apex</div>
      <div class="tab" data-tab="wow">WoW</div>
      <div class="tab" data-tab="backup">Backup</div>
    </div>
  </div>

  <!-- PILLARS -->
  <div id="pillars" class="tabcontent active">

    <div class="card">
      <div class="titleRow">
        <div class="h2">üëë Weekly Boss Fight (Mon‚ÄìSun)</div>
        <span class="badge"><strong>Week:</strong> <span id="weekLabel"></span></span>
      </div>
      <div class="small">
        Pass conditions (discipline only):
        <ul style="margin:6px 0 0 18px;padding:0">
          <li>Trading clean days ‚â• <b>3</b> (logged day, violations=0, not halted)</li>
          <li>Dialing days ‚â•120 mins: <b>5</b></li>
          <li>Body days (any Body action): <b>5</b></li>
          <li>Family days (any Family action): <b>5</b></li>
          <li>Habit mornings this week: <b>0</b></li>
        </ul>
      </div>

      <div class="twoCol" style="margin-top:10px">
        <div class="streakCard">
          <div class="small">Trading clean days</div>
          <b id="wkTradeClean">0</b>
        </div>
        <div class="streakCard">
          <div class="small">Dial 120+ days</div>
          <b id="wkDial120">0</b>
        </div>
        <div class="streakCard">
          <div class="small">Body days</div>
          <b id="wkBodyDays">0</b>
        </div>
        <div class="streakCard">
          <div class="small">Family days</div>
          <b id="wkFamilyDays">0</b>
        </div>
        <div class="streakCard">
          <div class="small">Habit mornings</div>
          <b id="wkHabitYes">0</b>
        </div>
        <div class="streakCard">
          <div class="small">Relationship avg (1‚Äì5)</div>
          <b id="wkRelAvg">‚Äî</b>
        </div>
      </div>

      <div id="bossPass" class="bannerOk" style="display:none;">
        <div class="ok">BOSS CLEARED</div>
        <div class="small">You earned the weekly bonus. Don‚Äôt get cute ‚Äî do it again.</div>
      </div>
      <div id="bossFail" class="banner" style="display:none;">
        <div class="warn">BOSS FAILED</div>
        <div class="small">
          Penalty rule: next Monday starts with <b>Trading Halted</b> until you log your first clean trading day.
        </div>
      </div>

      <div class="btnRow">
        <button onclick="awardWeeklyBonus()">Claim Weekly Bonus (if cleared)</button>
        <button class="secondary" onclick="setRelationshipRating(5)">Rel = 5</button>
        <button class="secondary" onclick="setRelationshipRating(4)">Rel = 4</button>
        <button class="secondary" onclick="setRelationshipRating(3)">Rel = 3</button>
        <button class="secondary" onclick="setRelationshipRating(2)">Rel = 2</button>
        <button class="secondary" onclick="setRelationshipRating(1)">Rel = 1</button>
      </div>
      <div class="small" id="relTodayText" style="margin-top:8px"></div>
    </div>

    <div class="card">
      <div class="titleRow"><div class="h2">üî• Streaks (discipline only)</div></div>
      <div class="streakGrid">
        <div class="streakCard"><div class="small">Clean trading streak</div><b id="stCleanTrade">0</b></div>
        <div class="streakCard"><div class="small">Dial 120+ streak</div><b id="stDial">0</b></div>
        <div class="streakCard"><div class="small">Cold plunge streak</div><b id="stPlunge">0</b></div>
        <div class="streakCard"><div class="small">Habit-free morning streak</div><b id="stHabitFree">0</b></div>
      </div>
      <div class="small" style="margin-top:8px">
        Streaks boost XP (automatically) but don‚Äôt punish you when broken. The punishment is your own rules (halt/penalty).
      </div>
    </div>

    <div class="grid">

      <div class="card">
        <div class="titleRow">
          <div class="h2">üß† Trader</div>
          <span class="badge"><strong>Today XP:</strong> <span id="todayTrader">0</span></span>
        </div>
        <div class="small">Trader XP freezes if trading is halted (your burn rule).</div>
        <div class="xpbar"><div class="xpfill" id="barTrader"></div></div>
        <div class="row small">
          <div>Level: <b id="cardLvlTrader">1</b></div>
          <div>XP: <b id="cardXpTrader">0</b> / <b id="needTrader">100</b></div>
        </div>
        <hr/>
        <div class="btnRow">
          <button class="danger" onclick="markHabitYesNow()">Habit = YES (halts trading)</button>
          <button class="secondary" onclick="markHabitNo()">Habit = NO (today)</button>
          <button class="danger" onclick="markTiltYes()">Tilt = YES (halt now + discipline XP)</button>
          <button class="secondary" onclick="markTiltNo()">Tilt = NO</button>
          <button class="secondary" onclick="toggleTradeHaltToday()">Toggle: Halt Today</button>
          <button class="secondary" onclick="toggleTradeHaltNext()">Toggle: Halt Next Day</button>
        </div>
        <div class="small" id="traderLockText" style="margin-top:8px"></div>
      </div>

      <div class="card">
        <div class="titleRow">
          <div class="h2">üí™ Body</div>
          <span class="badge"><strong>Today XP:</strong> <span id="todayBody">0</span></span>
        </div>
        <div class="xpbar"><div class="xpfill" id="barBody"></div></div>
        <div class="row small">
          <div>Level: <b id="cardLvlBody">1</b></div>
          <div>XP: <b id="cardXpBody">0</b> / <b id="needBody">100</b></div>
        </div>
        <hr/>
        <div class="btnRow">
          <button onclick="logBody('coldPlunge',25)">Cold plunge (+25)</button>
          <button onclick="logBody('lift',40)">Lift (+40)</button>
          <button onclick="logBody('diet',30)">Diet compliant (+30)</button>
          <button onclick="logBody('bedBy9',25)">In bed cutoff (+25)</button>
          <button onclick="logBody('habitAvoided',50)">Habit avoided (+50)</button>
        </div>
      </div>

      <div class="card">
        <div class="titleRow">
          <div class="h2">üíº Closer</div>
          <span class="badge"><strong>Today XP:</strong> <span id="todayCloser">0</span></span>
        </div>
        <div class="xpbar"><div class="xpfill" id="barCloser"></div></div>
        <div class="row small">
          <div>Level: <b id="cardLvlCloser">1</b></div>
          <div>XP: <b id="cardXpCloser">0</b> / <b id="needCloser">100</b></div>
        </div>
        <hr/>
        <div class="btnRow">
          <button onclick="logCloser('dial2h',50)">2h dialing (+50)</button>
          <button onclick="logCloser('deal',25)">Deal closed (+25)</button>
          <button onclick="logCloser('sourced',15)">Self-sourced (+15)</button>
          <button onclick="logCloser('noTrial',15)">No-trial (+15)</button>
        </div>
      </div>

      <div class="card">
        <div class="titleRow">
          <div class="h2">‚ù§Ô∏è Husband / Father</div>
          <span class="badge"><strong>Today XP:</strong> <span id="todayFamily">0</span></span>
        </div>
        <div class="xpbar"><div class="xpfill" id="barFamily"></div></div>
        <div class="row small">
          <div>Level: <b id="cardLvlFamily">1</b></div>
          <div>XP: <b id="cardXpFamily">0</b> / <b id="needFamily">100</b></div>
        </div>
        <hr/>
        <div class="btnRow">
          <button onclick="logFamily('spouseNoPhone',40)">Spouse time no phone (+40)</button>
          <button onclick="logFamily('kidsEngaged',30)">Kids engaged (+30)</button>
          <button onclick="logFamily('helpedUnasked',20)">Helped unasked (+20)</button>
          <button onclick="logFamily('calm',20)">Calm under stress (+20)</button>
          <button onclick="logFamily('weeklyDate',100)">Weekly date/leadership (+100)</button>
        </div>
      </div>

    </div>
  </div>

  <!-- TRADING -->
  <div id="trading" class="tabcontent">
    <div class="card">
      <div class="titleRow">
        <div class="h2">üìä Trading Dashboard (aggregate daily)</div>
        <span class="pill"><strong>Equity:</strong> $<span id="equityNow">0</span></span>
      </div>

      <div class="twoCol" style="margin-top:10px">
        <div class="banner" id="sizeGateBox" style="display:none;">
          <div class="warn">SIZE-UP LOCKED</div>
          <div class="small" id="sizeGateText"></div>
        </div>
        <div class="bannerOk" id="sizeGateOk" style="display:none;">
          <div class="ok">SIZE-UP UNLOCKED</div>
          <div class="small">You may increase size today. If you break rules, next day is halted.</div>
        </div>
      </div>

      <div id="lockOverlay" class="banner" style="display:none;">
        <div class="warn">TRADING HALTED ‚Äî NO MARKET INTERACTION</div>
        <div class="small">Trader XP is frozen today.</div>
      </div>

      <hr/>

      <div class="twoCol">
        <div class="card" style="margin:0;background:rgba(255,255,255,.02)">
          <div class="titleRow">
            <div class="h2">Add / Edit Day</div>
            <span class="badge"><strong>Date:</strong> <span id="editDateLabel"></span></span>
          </div>

          <div class="small" style="margin-top:6px">Wins</div>
          <input id="inWins" type="number" min="0" placeholder="e.g. 4"/>

          <div class="small" style="margin-top:10px">Losses</div>
          <input id="inLosses" type="number" min="0" placeholder="e.g. 2"/>

          <div class="small" style="margin-top:10px">Gross Profit ($)</div>
          <input id="inGrossProfit" type="number" step="0.01" placeholder="e.g. 650.25"/>

          <div class="small" style="margin-top:10px">Gross Loss ($) (positive number)</div>
          <input id="inGrossLoss" type="number" step="0.01" placeholder="e.g. 420.00"/>

          <div class="small" style="margin-top:10px">Rule Violations (0 if clean)</div>
          <input id="inVios" type="number" min="0" placeholder="0"/>

          <div class="small" style="margin-top:10px">Drawdown Buffer ($) (optional)</div>
          <input id="inDdBuf" type="number" step="0.01" placeholder="e.g. 4200"/>

          <div class="btnRow">
            <button onclick="saveTradingDay()">Save Day</button>
            <button class="secondary" onclick="jumpToToday()">Jump to Today</button>
            <button class="secondary" onclick="deleteTradingDay()">Delete This Day</button>
          </div>

          <div class="small" style="margin-top:10px">
            Auto rules:
            <ul style="margin:6px 0 0 18px;padding:0">
              <li>DD buffer &lt; 2000 ‚Üí trading halt today</li>
              <li>Violations &gt; 0 ‚Üí no Trader XP for that day</li>
              <li>Clean day (vios=0 and not halted) ‚Üí +50 Trader XP (once/day)</li>
              <li>If weekly penalty active ‚Üí trading stays halted until first clean day is logged</li>
            </ul>
          </div>
        </div>

        <div class="card" style="margin:0;background:rgba(255,255,255,.02)">
          <div class="titleRow">
            <div class="h2">Equity Curve</div>
            <span class="badge"><strong>Month:</strong> <span id="calMonthLabel"></span></span>
          </div>

          <canvas id="equityChart"></canvas>

          <hr/>

          <div class="twoCol" style="gap:8px">
            <div class="pill"><strong>Win Rate:</strong> <span id="statWr">0%</span></div>
            <div class="pill"><strong>Profit Factor:</strong> <span id="statPf">0.00</span></div>
            <div class="pill"><strong>Expectancy / Trade:</strong> $<span id="statExp">0</span></div>
            <div class="pill"><strong>Avg Win:</strong> $<span id="statAvgWin">0</span></div>
            <div class="pill"><strong>Avg Loss:</strong> $<span id="statAvgLoss">0</span></div>
            <div class="pill"><strong>Max Drawdown:</strong> $<span id="statMdd">0</span></div>
            <div class="pill"><strong>Green Days:</strong> <span id="statGreen">0</span></div>
            <div class="pill"><strong>Red Days:</strong> <span id="statRed">0</span></div>
            <div class="pill"><strong>Best Day:</strong> $<span id="statBest">0</span></div>
            <div class="pill"><strong>Worst Day:</strong> $<span id="statWorst">0</span></div>
            <div class="pill"><strong>Days Logged:</strong> <span id="statDays">0</span></div>
            <div class="pill"><strong>Trades:</strong> <span id="statTrades">0</span></div>
          </div>

          <hr/>

          <div class="titleRow">
            <div class="h2">Trade Calendar (click a day)</div>
            <span class="badge"><strong>Selected:</strong> <span id="selectedDateLabel"></span></span>
          </div>

          <div class="calHead">
            <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
          </div>
          <div id="calendar" class="calWrap"></div>

          <div class="calLegend">
            <span class="swatch"><span class="box" style="background:rgba(74,222,128,.35)"></span>Green</span>
            <span class="swatch"><span class="box" style="background:rgba(251,113,133,.35)"></span>Red</span>
            <span class="swatch"><span class="box" style="background:rgba(255,255,255,.06)"></span>No log</span>
            <span class="swatch"><span class="box" style="background:rgba(251,191,36,.30)"></span>Violations</span>
            <span class="swatch"><span class="box" style="background:rgba(96,165,250,.25)"></span>Halted</span>
          </div>
        </div>
      </div>

      <hr/>

      <div class="h2">Daily Logs</div>
      <div style="overflow:auto;margin-top:10px">
        <table>
          <thead>
            <tr>
              <th>Date</th><th>W</th><th>L</th><th>Gross Profit</th><th>Gross Loss</th>
              <th>Net</th><th>Vios</th><th>DD Buf</th><th>Halted</th>
            </tr>
          </thead>
          <tbody id="logTable"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- SALES -->
  <div id="sales" class="tabcontent">
    <div class="card">
      <div class="titleRow">
        <div class="h2">üíº Sales Quota Board</div>
        <span class="badge"><strong>Month:</strong> <span id="salesMonthLabel"></span></span>
      </div>
      <div class="small">Quota + deal mix + dialing + pace.</div>

      <hr/>

      <div class="twoCol">
        <div class="card" style="margin:0;background:rgba(255,255,255,.02)">
          <div class="h2">Quota Settings</div>
          <div class="small" style="margin-top:6px">Default $76,000.</div>
          <div class="small" style="margin-top:10px">Monthly Quota ($)</div>
          <input id="inQuota" type="number" step="0.01" placeholder="76000"/>
          <div class="btnRow">
            <button onclick="saveQuota()">Save Quota</button>
            <button class="secondary" onclick="setQuota76000()">Set $76,000</button>
          </div>

          <hr/>

          <div class="h2">Daily Dialing</div>
          <div class="small">Log minutes. Target is 120.</div>
          <div class="small" style="margin-top:10px">Minutes Dialed (today)</div>
          <input id="inDialMins" type="number" min="0" placeholder="120"/>
          <div class="btnRow">
            <button onclick="saveDialing()">Save Dialing</button>
            <button class="secondary" onclick="markDialed120()">Mark 120</button>
          </div>
        </div>

        <div class="card" style="margin:0;background:rgba(255,255,255,.02)">
          <div class="h2">Monthly Progress</div>
          <div class="progress" style="margin-top:10px"><div id="quotaBar"></div></div>
          <div class="row small">
            <div>MTD Closed: <b>$<span id="mtdClosed">0</span></b></div>
            <div>Goal: <b>$<span id="mtdGoal">76,000</span></b></div>
          </div>

          <div class="twoCol" style="gap:8px;margin-top:10px">
            <div class="pill"><strong>Sourced $:</strong> $<span id="mtdSourced">0</span></div>
            <div class="pill"><strong>Inbound $:</strong> $<span id="mtdInbound">0</span></div>
            <div class="pill"><strong>No-trial $:</strong> $<span id="mtdNoTrial">0</span></div>
            <div class="pill"><strong>Trial $:</strong> $<span id="mtdTrial">0</span></div>
            <div class="pill"><strong>Deals:</strong> <span id="mtdDeals">0</span></div>
            <div class="pill"><strong>Dial Minutes:</strong> <span id="mtdDial">0</span></div>
          </div>

          <hr/>

          <div class="h2">Daily Pace</div>
          <div class="small">Remaining quota / remaining business days (Mon‚ÄìFri).</div>
          <div class="pill" style="margin-top:8px"><strong>Today‚Äôs pace:</strong> $<span id="paceToday">0</span></div>
        </div>
      </div>

      <hr/>

      <div class="twoCol">
        <div class="card" style="margin:0;background:rgba(255,255,255,.02)">
          <div class="titleRow">
            <div class="h2">Add Deal</div>
            <span class="badge"><strong>Date:</strong> <span id="dealDateLabel"></span></span>
          </div>

          <div class="small" style="margin-top:10px">Deal Amount ($)</div>
          <input id="inDealAmt" type="number" step="0.01" placeholder="e.g. 12000"/>

          <div class="small" style="margin-top:10px">Source</div>
          <select id="inDealSource">
            <option value="sourced">Sourced (higher pay)</option>
            <option value="inbound">Inbound (marketing)</option>
          </select>

          <div class="small" style="margin-top:10px">Trial?</div>
          <select id="inDealTrial">
            <option value="no">No Trial (higher pay)</option>
            <option value="yes">Trial</option>
          </select>

          <div class="small" style="margin-top:10px">Notes (optional)</div>
          <input id="inDealNotes" placeholder="Client / product / short note"/>

          <div class="btnRow">
            <button onclick="addDeal()">Add Deal</button>
            <button class="secondary" onclick="jumpSalesToday()">Jump to Today</button>
          </div>
        </div>

        <div class="card" style="margin:0;background:rgba(255,255,255,.02)">
          <div class="titleRow">
            <div class="h2">Deals This Month</div>
            <span class="badge"><strong>MTD:</strong> $<span id="dealMtdQuick">0</span></span>
          </div>

          <div style="overflow:auto;margin-top:10px">
            <table>
              <thead>
                <tr><th>Date</th><th>Amount</th><th>Source</th><th>Trial</th><th>Notes</th><th></th></tr>
              </thead>
              <tbody id="dealTable"></tbody>
            </table>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- APEX -->
  <div id="apex" class="tabcontent">
    <div class="card">
      <div class="titleRow">
        <div class="h2">üè¶ Apex Payout Tracker (high-level)</div>
        <span class="badge"><strong>Goal:</strong> $<span id="apexGoalLabel">500,000</span></span>
      </div>
      <div class="small">This is not for daily PnL. It‚Äôs to keep your brain focused on payouts, not gambling.</div>

      <hr/>

      <div class="twoCol">
        <div class="card" style="margin:0;background:rgba(255,255,255,.02)">
          <div class="h2">Inputs</div>

          <div class="small" style="margin-top:10px">Annual Payout Goal ($)</div>
          <input id="inApexGoal" type="number" step="1" placeholder="500000"/>

          <div class="small" style="margin-top:10px">Payouts Received YTD ($)</div>
          <input id="inApexYtd" type="number" step="0.01" placeholder="0"/>

          <div class="small" style="margin-top:10px">Number of Payouts Completed</div>
          <input id="inApexCount" type="number" step="1" placeholder="0"/>

          <div class="small" style="margin-top:10px">Next Eligible Payout Date</div>
          <input id="inApexNext" type="date"/>

          <div class="small" style="margin-top:10px">Notes (policy / reminders)</div>
          <input id="inApexNotes" placeholder="e.g. 5 payout policy, next payout window..."/>

          <div class="btnRow">
            <button onclick="saveApex()">Save</button>
            <button class="secondary" onclick="setApexGoal500()">Set Goal $500k</button>
          </div>
        </div>

        <div class="card" style="margin:0;background:rgba(255,255,255,.02)">
          <div class="h2">Progress</div>
          <div class="progress" style="margin-top:10px"><div id="apexBar"></div></div>
          <div class="row small">
            <div>YTD: <b>$<span id="apexYtdLabel">0</span></b></div>
            <div>Goal: <b>$<span id="apexGoalLabel2">500,000</span></b></div>
          </div>
          <div class="twoCol" style="gap:8px;margin-top:10px">
            <div class="pill"><strong>Payout count:</strong> <span id="apexCountLabel">0</span></div>
            <div class="pill"><strong>Next eligible:</strong> <span id="apexNextLabel">‚Äî</span></div>
            <div class="pill"><strong>Notes:</strong> <span id="apexNotesLabel">‚Äî</span></div>
          </div>
          <div class="bannerOk" style="margin-top:10px">
            <div class="ok">Rule</div>
            <div class="small">Your only job is to keep the system clean enough to collect payouts. Everything else is noise.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- WOW -->
  <div id="wow" class="tabcontent">
    <div class="card">
      <div class="titleRow">
        <div class="h2">üéÆ WoW Unlock (30 minutes)</div>
        <span class="badge"><strong>Status:</strong> <span id="wowStatus">...</span></span>
      </div>

      <div class="small">
        Unlock conditions (daily):
        <ul style="margin:6px 0 0 18px;padding:0">
          <li>Trading is <b>not halted</b> today</li>
          <li>If you logged trading today ‚Üí violations must be <b>0</b></li>
          <li>Dialing minutes today ‚â• <b>120</b></li>
          <li>Family today XP &gt; <b>0</b></li>
        </ul>
      </div>

      <div id="wowLockBanner" class="banner" style="display:none;">
        <div class="warn">LOCKED</div>
        <div class="small" id="wowLockReason"></div>
      </div>

      <div id="wowUnlockBanner" class="bannerOk" style="display:none;">
        <div class="ok">UNLOCKED ‚Äî 30 MINUTES MAX</div>
        <div class="small">Start the timer. When it hits 0, stop. No side quests.</div>
      </div>

      <hr/>

      <div class="twoCol">
        <div class="card" style="margin:0;background:rgba(255,255,255,.02)">
          <div class="h2">Timer</div>
          <div class="timer" id="wowTimer">30:00</div>
          <div class="btnRow">
            <button onclick="startWow()">Start</button>
            <button class="secondary" onclick="pauseWow()">Pause</button>
            <button class="secondary" onclick="resetWow()">Reset 30:00</button>
          </div>
        </div>

        <div class="card" style="margin:0;background:rgba(255,255,255,.02)">
          <div class="h2">Quick Checks</div>
          <div class="twoCol" style="gap:8px;margin-top:10px">
            <div class="pill"><strong>Trading Today:</strong> <span id="wowChkTrading">?</span></div>
            <div class="pill"><strong>Violations Today:</strong> <span id="wowChkVios">?</span></div>
            <div class="pill"><strong>Dial Minutes:</strong> <span id="wowChkDial">?</span></div>
            <div class="pill"><strong>Family XP Today:</strong> <span id="wowChkFam">?</span></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- BACKUP -->
  <div id="backup" class="tabcontent">
    <div class="card">
      <div class="h2">Backup / Restore</div>
      <div class="small">This lives on your device. Export weekly.</div>
      <hr/>
      <div class="btnRow">
        <button onclick="exportData()">Export JSON</button>
        <button class="secondary" onclick="document.getElementById('importBox').focus()">Import JSON</button>
        <button class="danger" onclick="hardResetAll()">Hard Reset All</button>
      </div>
      <div class="small" style="margin-top:10px">Paste JSON here to restore:</div>
      <textarea id="importBox" rows="8" placeholder="Paste exported JSON here"></textarea>
      <div class="btnRow"><button class="secondary" onclick="importData()">Restore Now</button></div>
    </div>
  </div>

</div>

<script>
/* =========================
   STORAGE (kept SAME to preserve your existing data)
   ========================= */
const KEY = "beastDashboard_v6"; // DO NOT change if you want persistence
const todayKey = () => new Date().toDateString();
const monthKey = (d=new Date()) => `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
const dayName = (d)=> ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][d.getDay()];

/* =========================
   DEFAULTS + SAFE MIGRATION
   ========================= */
const defaults = {
  lastDate: null,
  pillars: {
    trader: { lvl: 1, xp: 0, todayXP: 0 },
    body:   { lvl: 1, xp: 0, todayXP: 0 },
    closer: { lvl: 1, xp: 0, todayXP: 0 },
    family: { lvl: 1, xp: 0, todayXP: 0 },
  },
  locks: {
    tradingHaltedToday:false,
    tradingHaltedNext:false,
    habitYesToday:false,
    tiltYesToday:false,
    weekPenaltyActive:false
  },
  trading: { selectedDate:null, dailyLogs:{} },
  sales: { quotaByMonth:{}, dialingByDate:{}, deals:[] },
  wow: { remainingSec: 30*60, running:false, lastTick:null },
  daily: {
    // dateStr: { tags:{}, pillarActions:{}, relationshipRating:null, habitYes:false }
    byDate: {}
  },
  weekly: {
    // weekKey: { bonusClaimed:false, passed:null } // passed computed; stored for penalty
    byWeek: {}
  },
  apex: {
    goal: 500000,
    ytd: 0,
    payoutCount: 0,
    nextEligible: "",
    notes: ""
  }
};

function deepMerge(target, source){
  for(const k in source){
    if(source[k] && typeof source[k] === "object" && !Array.isArray(source[k])){
      if(!target[k] || typeof target[k] !== "object") target[k] = {};
      deepMerge(target[k], source[k]);
    } else {
      if(target[k] === undefined) target[k] = source[k];
    }
  }
  return target;
}

let state = (() => {
  try { return JSON.parse(localStorage.getItem(KEY)) || structuredClone(defaults); }
  catch { return structuredClone(defaults); }
})();
state = deepMerge(state, structuredClone(defaults));

function save(){ localStorage.setItem(KEY, JSON.stringify(state)); render(); }

function ensureTodayDaily(){
  const d = todayKey();
  if(!state.daily.byDate[d]) state.daily.byDate[d] = { tags:{}, pillarActions:{}, relationshipRating:null, habitYes:false };
  return state.daily.byDate[d];
}

/* =========================
   DAY RESET
   ========================= */
function resetIfNewDay(){
  const t = todayKey();
  if(state.lastDate !== t){
    // carry over next-day halt
    state.locks.tradingHaltedToday = !!state.locks.tradingHaltedNext;
    state.locks.tradingHaltedNext = false;

    // daily habit flags
    state.locks.habitYesToday = false;
    state.locks.tiltYesToday = false;

    // reset daily XP
    for(const k of Object.keys(state.pillars)) state.pillars[k].todayXP = 0;

    // reset WoW
    state.wow.remainingSec = 30*60;
    state.wow.running = false;
    state.wow.lastTick = null;

    // default selected date
    state.trading.selectedDate = t;

    // ensure daily bucket
    ensureTodayDaily();

    // Monday penalty activation if last week failed
    const now = new Date();
    if(now.getDay() === 1){ // Monday
      const prevWeekKey = getWeekKey(addDays(now, -7));
      const prev = state.weekly.byWeek[prevWeekKey];
      if(prev && prev.passed === false){
        state.locks.weekPenaltyActive = true;
      }
    }

    state.lastDate = t;
    localStorage.setItem(KEY, JSON.stringify(state));
  }
}
resetIfNewDay();

/* =========================
   XP / LEVELS
   ========================= */
function needForLevel(lvl){ return 100 * lvl; }

function addXP(pillar, amount, opts={ bypassFreeze:false }){
  resetIfNewDay();

  if(pillar === "trader" && state.locks.tradingHaltedToday && !opts.bypassFreeze){
    alert("Trader XP is frozen because trading is halted today.");
    return;
  }

  const p = state.pillars[pillar];
  p.xp += amount;
  p.todayXP += amount;

  while(p.xp >= needForLevel(p.lvl)){
    p.xp -= needForLevel(p.lvl);
    p.lvl += 1;
  }

  // Record daily actions (for weekly + streaks)
  const day = ensureTodayDaily();
  if(!day.pillarActions[pillar]) day.pillarActions[pillar] = 0;
  day.pillarActions[pillar] += 1;

  save();
}

/* =========================
   SPECIFIC LOGGERS (so we can streak them)
   ========================= */
function tagToday(tag){
  const day = ensureTodayDaily();
  day.tags[tag] = true;
  save();
}
function logBody(tag, xp){ tagToday(tag); addXP("body", xp); }
function logCloser(tag, xp){ tagToday(tag); addXP("closer", xp); }
function logFamily(tag, xp){ tagToday(tag); addXP("family", xp); }

/* =========================
   RANK GATE
   ========================= */
function avgLevel(){
  const lvls = Object.values(state.pillars).map(p=>p.lvl);
  return lvls.reduce((a,b)=>a+b,0) / lvls.length;
}
function minLevelRequiredForRank(rank){
  if(rank <= 5) return 1;
  if(rank <= 10) return 5;
  if(rank <= 15) return 10;
  if(rank <= 20) return 15;
  return 20;
}
function computeRank(){
  const target = Math.floor(avgLevel());
  const minReq = minLevelRequiredForRank(target);
  const weakest = Math.min(state.pillars.trader.lvl, state.pillars.body.lvl, state.pillars.closer.lvl, state.pillars.family.lvl);
  if(weakest < minReq){
    let r = target;
    while(r > 1 && weakest < minLevelRequiredForRank(r)) r--;
    return { rank: Math.max(1,r), gated:true, target, minReq, weakest };
  }
  return { rank: Math.max(1,target), gated:false, target, minReq, weakest };
}

/* =========================
   HABIT / TILT / HALTS
   ========================= */
function markHabitYesNow(){
  resetIfNewDay();
  state.locks.habitYesToday = true;
  state.locks.tradingHaltedToday = true;

  const day = ensureTodayDaily();
  day.habitYes = true;

  save();
}
function markHabitNo(){
  resetIfNewDay();
  state.locks.habitYesToday = false;
  ensureTodayDaily().habitYes = false;
  save();
}

function markTiltYes(){
  resetIfNewDay();
  // award discipline XP BEFORE halting (bypass freeze)
  addXP("trader", 25, { bypassFreeze:true });
  state.locks.tiltYesToday = true;
  state.locks.tradingHaltedToday = true;
  tagToday("tilt");
  save();
}
function markTiltNo(){
  resetIfNewDay();
  state.locks.tiltYesToday = false;
  save();
}

function toggleTradeHaltToday(){ resetIfNewDay(); state.locks.tradingHaltedToday = !state.locks.tradingHaltedToday; save(); }
function toggleTradeHaltNext(){ resetIfNewDay(); state.locks.tradingHaltedNext = !state.locks.tradingHaltedNext; save(); }

/* =========================
   TRADING LOGS + STATS
   ========================= */
function parseNum(id, fallback=0){
  const v = document.getElementById(id).value;
  if(v === "" || v === null || v === undefined) return fallback;
  const n = Number(v);
  return Number.isFinite(n) ? n : fallback;
}
function getSelectedTradingDate(){ return state.trading.selectedDate || todayKey(); }
function setSelectedTradingDate(d){ state.trading.selectedDate = d; save(); }

function saveTradingDay(){
  resetIfNewDay();
  const d = getSelectedTradingDate();

  const wins = parseNum("inWins", 0);
  const losses = parseNum("inLosses", 0);
  const grossProfit = parseNum("inGrossProfit", 0);
  const grossLoss = parseNum("inGrossLoss", 0);
  const vios = parseNum("inVios", 0);
  const ddRaw = document.getElementById("inDdBuf").value;
  const ddBuf = (ddRaw === "" ? null : Number(ddRaw));

  const net = gross
