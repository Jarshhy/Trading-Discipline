<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>2026 Beast Dashboard</title>
  <style>
    :root{
      --bg:#0b0c14; --panel:#14162a; --text:#e8eaf3; --muted:rgba(232,234,243,.7);
      --line:rgba(255,255,255,.10); --purple:#7b6cff; --accent:#f6c56b;
      --green:#4ade80; --red:#fb7185; --blue:#60a5fa;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:radial-gradient(1200px 600px at 20% 0%, rgba(123,108,255,.22), transparent 55%),
                 radial-gradient(900px 500px at 80% 0%, rgba(246,197,107,.16), transparent 60%),
                 var(--bg);
      color:var(--text);
    }
    header{
      position:sticky; top:0; z-index:10;
      padding:14px 16px;
      border-bottom:1px solid var(--line);
      background:linear-gradient(135deg, rgba(30,27,75,.85), rgba(17,24,39,.55));
    }
    h1{margin:0;font-size:16px;letter-spacing:.2px}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .card{
      background:linear-gradient(180deg, rgba(20,22,42,.95), rgba(12,14,28,.95));
      border:1px solid var(--line);
      border-radius:14px;
      padding:14px;
      box-shadow:0 10px 30px rgba(0,0,0,.35);
      margin-bottom:12px;
    }
    .kpis{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(170px,1fr));
      gap:10px;
    }
    .kpi{
      background:rgba(255,255,255,.03);
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px;
      text-align:center;
    }
    .kpi b{font-size:18px}
    .small{font-size:12px;color:var(--muted);line-height:1.35}
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:6px 10px;border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      font-size:12px;color:var(--muted);
      margin:4px 6px 0 0;
    }
    .pill strong{color:var(--text)}
    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
      gap:12px;
    }
    .titleRow{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:8px}
    .h2{font-size:13px;margin:0;color:rgba(232,234,243,.95);letter-spacing:.2px}
    .xpbar{
      height:10px;border-radius:999px;overflow:hidden;
      background:rgba(255,255,255,.08);
      border:1px solid var(--line);
      margin-top:8px;
    }
    .xpfill{
      height:100%; width:0%;
      background:linear-gradient(90deg,var(--purple),var(--accent));
      transition:width .35s ease;
    }
    .row{display:flex;justify-content:space-between;gap:10px;margin-top:8px}
    .btnRow{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    button{
      border:none;border-radius:10px;padding:8px 10px;
      cursor:pointer;font-weight:800;
      background:var(--accent);color:#101012;
    }
    button.secondary{background:rgba(255,255,255,.08);color:var(--text);border:1px solid var(--line)}
    button.danger{background:rgba(251,113,133,.95);color:#0b0c14}
    button:disabled{opacity:.55;cursor:not-allowed}
    hr{border:none;border-top:1px solid var(--line);margin:12px 0}
    .warn{color:rgba(251,113,133,.95);font-weight:800}
    .ok{color:rgba(74,222,128,.95);font-weight:800}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,monospace}
  </style>
</head>
<body>
<header>
  <h1>2026 Beast Dashboard ‚Äî 4 Pillars, 1 Rank, No Loopholes</h1>
</header>

<div class="wrap">

  <!-- GLOBAL HEADER -->
  <div class="card">
    <div class="kpis">
      <div class="kpi">Overall Rank<br><b id="overallRank">1</b><div class="small" id="rankGateText"></div></div>
      <div class="kpi">Trader Level<br><b id="lvlTrader">1</b><div class="small" id="xpTraderText"></div></div>
      <div class="kpi">Body Level<br><b id="lvlBody">1</b><div class="small" id="xpBodyText"></div></div>
      <div class="kpi">Closer Level<br><b id="lvlCloser">1</b><div class="small" id="xpCloserText"></div></div>
      <div class="kpi">Family Level<br><b id="lvlFamily">1</b><div class="small" id="xpFamilyText"></div></div>
    </div>

    <div style="margin-top:10px">
      <span class="pill" id="pillTradeToday"><strong>Trading Today:</strong> Unknown</span>
      <span class="pill" id="pillTradeNext"><strong>Trading Next Day:</strong> Unknown</span>
      <span class="pill" id="pillDD"><strong>Drawdown Rule:</strong> Stop &lt; $2,000</span>
      <span class="pill" id="pillHabit"><strong>Habit Rule:</strong> If YES ‚Üí No Trading (today/next)</span>
    </div>

    <div class="btnRow">
      <button class="danger" onclick="markHabitYesNow()">Habit = YES (trading stops)</button>
      <button class="secondary" onclick="markHabitNo()">Habit = NO (for today)</button>
      <button class="secondary" onclick="toggleTradeHaltToday()">Toggle: Trading Halted Today</button>
      <button class="secondary" onclick="toggleTradeHaltNext()">Toggle: Trading Halted Next Day</button>
      <button class="secondary" onclick="resetToday()">Reset Today (only today‚Äôs toggles)</button>
    </div>

    <div class="small" style="margin-top:10px">
      Habit tracking: if you press <span class="mono">Habit = YES</span> before trading, trading is halted today.  
      If habit happens after trading, press it anyway ‚Äî it will set <span class="mono">Trading Halted Next Day</span>.
      (We‚Äôll make this fully automatic in Step 3 when we add timestamps and ‚Äúfirst-trade lock‚Äù.)
    </div>
  </div>

  <!-- 4 PILLAR CARDS -->
  <div class="grid">

    <div class="card">
      <div class="titleRow">
        <div class="h2">üß† Trader</div>
        <span class="pill"><strong>Today XP:</strong> <span id="todayTrader">0</span></span>
      </div>
      <div class="small">XP to next level = <b>100 √ó current level</b>. Trader XP should feel earned.</div>
      <div class="xpbar"><div class="xpfill" id="barTrader"></div></div>
      <div class="row small">
        <div>Level: <b id="cardLvlTrader">1</b></div>
        <div>XP: <b id="cardXpTrader">0</b> / <b id="needTrader">100</b></div>
      </div>
      <hr/>
      <div class="btnRow">
        <button onclick="addXP('trader',50)">All Apex rules followed (+50)</button>
        <button onclick="addXP('trader',40)">Stopped correctly at DD (+40)</button>
        <button onclick="addXP('trader',20)">Journal complete (+20)</button>
        <button class="danger" onclick="addXP('trader',-100)">Size-up after red (-100)</button>
      </div>
      <div class="small" id="traderLockText"></div>
    </div>

    <div class="card">
      <div class="titleRow">
        <div class="h2">üí™ Body</div>
        <span class="pill"><strong>Today XP:</strong> <span id="todayBody">0</span></span>
      </div>
      <div class="small">Binary compliance beats perfect plans.</div>
      <div class="xpbar"><div class="xpfill" id="barBody"></div></div>
      <div class="row small">
        <div>Level: <b id="cardLvlBody">1</b></div>
        <div>XP: <b id="cardXpBody">0</b> / <b id="needBody">100</b></div>
      </div>
      <hr/>
      <div class="btnRow">
        <button onclick="addXP('body',25)">Cold plunge (+25)</button>
        <button onclick="addXP('body',40)">Lift (+40)</button>
        <button onclick="addXP('body',30)">Diet compliant (+30)</button>
        <button onclick="addXP('body',25)">In bed by cutoff (+25)</button>
        <button onclick="addXP('body',50)">Habit avoided (+50)</button>
      </div>
    </div>

    <div class="card">
      <div class="titleRow">
        <div class="h2">üíº Closer</div>
        <span class="pill"><strong>Today XP:</strong> <span id="todayCloser">0</span></span>
      </div>
      <div class="small">Inputs first. Closings are bonuses.</div>
      <div class="xpbar"><div class="xpfill" id="barCloser"></div></div>
      <div class="row small">
        <div>Level: <b id="cardLvlCloser">1</b></div>
        <div>XP: <b id="cardXpCloser">0</b> / <b id="needCloser">100</b></div>
      </div>
      <hr/>
      <div class="btnRow">
        <button onclick="addXP('closer',50)">2h dialing (+50)</button>
        <button onclick="addXP('closer',20)">CRM + follow-ups (+20)</button>
        <button onclick="addXP('closer',25)">Deal closed (+25)</button>
        <button onclick="addXP('closer',15)">Self-sourced bonus (+15)</button>
        <button onclick="addXP('closer',15)">No-trial bonus (+15)</button>
      </div>
    </div>

    <div class="card">
      <div class="titleRow">
        <div class="h2">‚ù§Ô∏è Husband / Father</div>
        <span class="pill"><strong>Today XP:</strong> <span id="todayFamily">0</span></span>
      </div>
      <div class="small">Presence is a skill. Train it like one.</div>
      <div class="xpbar"><div class="xpfill" id="barFamily"></div></div>
      <div class="row small">
        <div>Level: <b id="cardLvlFamily">1</b></div>
        <div>XP: <b id="cardXpFamily">0</b> / <b id="needFamily">100</b></div>
      </div>
      <hr/>
      <div class="btnRow">
        <button onclick="addXP('family',40)">Spouse time (no phone) (+40)</button>
        <button onclick="addXP('family',30)">Kid time engaged (+30)</button>
        <button onclick="addXP('family',20)">Helped unasked (+20)</button>
        <button onclick="addXP('family',20)">Calm under stress (+20)</button>
        <button onclick="addXP('family',100)">Weekly date/leadership (+100)</button>
      </div>
    </div>

  </div>

  <div class="card">
    <h1 style="font-size:14px;margin:0 0 8px 0">What ‚ÄúRank Gated‚Äù means</h1>
    <div class="small">
      Overall Rank = average of pillar levels.  
      Rank can only increase if <b>each pillar</b> meets the minimum required for that Rank band:
      <div style="margin-top:8px">
        Rank 1‚Äì5 ‚áí min level 1+ ‚Ä¢ Rank 6‚Äì10 ‚áí min level 5+ ‚Ä¢ Rank 11‚Äì15 ‚áí min level 10+ ‚Ä¢ Rank 16‚Äì20 ‚áí min level 15+ ‚Ä¢ Rank 21‚Äì25 ‚áí min level 20+
      </div>
    </div>
  </div>

</div>

<script>
/* =======================
   DATA + RESET ENGINE
   ======================= */
const KEY = "beastDashboard_v1";

const todayKey = () => new Date().toDateString();

const defaults = {
  lastDate: null,
  // Pillars all share the same XP curve: need = 100 * level
  pillars: {
    trader: { lvl: 1, xp: 0, todayXP: 0 },
    body:   { lvl: 1, xp: 0, todayXP: 0 },
    closer: { lvl: 1, xp: 0, todayXP: 0 },
    family: { lvl: 1, xp: 0, todayXP: 0 },
  },
  // Locks and habit logic
  locks: {
    tradingHaltedToday: false,
    tradingHaltedNext: false,
    habitYesToday: false
  }
};

let state = JSON.parse(localStorage.getItem(KEY)) || structuredClone(defaults);

function needForLevel(lvl){ return 100 * lvl; }

function resetIfNewDay(){
  const t = todayKey();
  if(state.lastDate !== t){
    // shift "next day trading halt" into today automatically
    state.locks.tradingHaltedToday = !!state.locks.tradingHaltedNext;
    state.locks.tradingHaltedNext = false;
    state.locks.habitYesToday = false;

    // reset daily XP counters
    for(const k of Object.keys(state.pillars)){
      state.pillars[k].todayXP = 0;
    }
    state.lastDate = t;
    save();
  }
}

function save(){
  localStorage.setItem(KEY, JSON.stringify(state));
  render();
}

resetIfNewDay();

/* =======================
   XP + LEVELING
   ======================= */
function addXP(pillar, amount){
  resetIfNewDay();

  // If trading is halted today, Trader XP is frozen (your "burn")
  if(pillar === "trader" && state.locks.tradingHaltedToday){
    alert("Trader XP is frozen because trading is halted today.");
    return;
  }

  const p = state.pillars[pillar];

  // Apply XP (can be negative)
  p.xp += amount;
  p.todayXP += amount;

  // Prevent negative XP below 0 at current level
  if(p.xp < 0){ p.xp = 0; }

  // Level up loop
  while(p.xp >= needForLevel(p.lvl)){
    p.xp -= needForLevel(p.lvl);
    p.lvl += 1;
  }

  save();
}

/* =======================
   OVERALL RANK + GATES
   ======================= */
function avgLevel(){
  const lvls = Object.values(state.pillars).map(p=>p.lvl);
  return lvls.reduce((a,b)=>a+b,0) / lvls.length;
}

function minLevelRequiredForRank(rank){
  if(rank <= 5) return 1;
  if(rank <= 10) return 5;
  if(rank <= 15) return 10;
  if(rank <= 20) return 15;
  return 20; // rank 21‚Äì25+ band
}

function computeRank(){
  const raw = avgLevel();
  const targetRank = Math.floor(raw); // integer rank

  // Gate: rank can only be as high as the weakest pillar allows for that band
  const minReq = minLevelRequiredForRank(targetRank);
  const minPillarLvl = Math.min(
    state.pillars.trader.lvl,
    state.pillars.body.lvl,
    state.pillars.closer.lvl,
    state.pillars.family.lvl
  );

  if(minPillarLvl < minReq){
    // Clamp rank to the highest rank whose requirement you actually meet
    // We'll step down until requirement is satisfied.
    let r = targetRank;
    while(r > 1 && minPillarLvl < minLevelRequiredForRank(r)){
      r--;
    }
    return { rank: Math.max(1,r), gated:true, minReq: minLevelRequiredForRank(targetRank), weakest:minPillarLvl, target:targetRank };
  }
  return { rank: Math.max(1,targetRank), gated:false, minReq, weakest:minPillarLvl, target:targetRank };
}

/* =======================
   LOCK / HABIT ACTIONS
   ======================= */
function markHabitYesNow(){
  resetIfNewDay();
  state.locks.habitYesToday = true;

  // If you haven't traded yet (we're not tracking trade times yet), we enforce: trading halted today.
  // If it happens after trading, you still press this and you will manually toggle next-day halt (for now).
  state.locks.tradingHaltedToday = true;

  save();
  alert("Habit marked YES. Trading halted today. (If this occurred after trading, also toggle 'Trading Halted Next Day'.)");
}

function markHabitNo(){
  resetIfNewDay();
  state.locks.habitYesToday = false;
  save();
}

function toggleTradeHaltToday(){
  resetIfNewDay();
  state.locks.tradingHaltedToday = !state.locks.tradingHaltedToday;
  save();
}

function toggleTradeHaltNext(){
  resetIfNewDay();
  state.locks.tradingHaltedNext = !state.locks.tradingHaltedNext;
  save();
}

function resetToday(){
  resetIfNewDay();
  state.locks.habitYesToday = false;
  state.locks.tradingHaltedToday = false;
  // leave next-day flag alone unless you explicitly change it
  for(const k of Object.keys(state.pillars)){
    state.pillars[k].todayXP = 0;
  }
  save();
}

/* =======================
   RENDER
   ======================= */
function setBar(barId, lvl, xp){
  const need = needForLevel(lvl);
  const pct = Math.max(0, Math.min(100, (xp/need)*100));
  document.getElementById(barId).style.width = pct + "%";
  return need;
}

function render(){
  resetIfNewDay();

  // Rank
  const r = computeRank();
  overallRank.textContent = r.rank;

  if(r.gated){
    rankGateText.innerHTML = `<span class="warn">GATED</span> ‚Äî target rank ${r.target} requires min pillar level <b>${r.minReq}</b>. Weakest pillar is <b>${r.weakest}</b>.`;
  } else {
    rankGateText.innerHTML = `<span class="ok">UNLOCKED</span> ‚Äî rank can progress normally.`;
  }

  // Lock pills
  pillTradeToday.innerHTML = `<strong>Trading Today:</strong> ${state.locks.tradingHaltedToday ? '<span class="warn">HALTED</span>' : '<span class="ok">ALLOWED</span>'}`;
  pillTradeNext.innerHTML = `<strong>Trading Next Day:</strong> ${state.locks.tradingHaltedNext ? '<span class="warn">HALTED</span>' : '<span class="ok">ALLOWED</span>'}`;

  // Trader
  const t = state.pillars.trader;
  lvlTrader.textContent = t.lvl;
  cardLvlTrader.textContent = t.lvl;
  cardXpTrader.textContent = t.xp;
  todayTrader.textContent = t.todayXP;
  const needT = setBar("barTrader", t.lvl, t.xp);
  needTrader.textContent = needT;
  xpTraderText.textContent = `${t.xp} / ${needT} XP`;

  traderLockText.innerHTML = state.locks.tradingHaltedToday
    ? `<span class="warn">Trader XP frozen today</span> (trading halted = no market interaction).`
    : `<span class="ok">Trader XP active</span>.`;

  // Body
  const b = state.pillars.body;
  lvlBody.textContent = b.lvl;
  cardLvlBody.textContent = b.lvl;
  cardXpBody.textContent = b.xp;
  todayBody.textContent = b.todayXP;
  const needB = setBar("barBody", b.lvl, b.xp);
  needBody.textContent = needB;
  xpBodyText.textContent = `${b.xp} / ${needB} XP`;

  // Closer
  const c = state.pillars.closer;
  lvlCloser.textContent = c.lvl;
  cardLvlCloser.textContent = c.lvl;
  cardXpCloser.textContent = c.xp;
  todayCloser.textContent = c.todayXP;
  const needC = setBar("barCloser", c.lvl, c.xp);
  needCloser.textContent = needC;
  xpCloserText.textContent = `${c.xp} / ${needC} XP`;

  // Family
  const f = state.pillars.family;
  lvlFamily.textContent = f.lvl;
  cardLvlFamily.textContent = f.lvl;
  cardXpFamily.textContent = f.xp;
  todayFamily.textContent = f.todayXP;
  const needF = setBar("barFamily", f.lvl, f.xp);
  needFamily.textContent = needF;
  xpFamilyText.textContent = `${f.xp} / ${needF} XP`;
}

render();
</script>
</body>
</html>
